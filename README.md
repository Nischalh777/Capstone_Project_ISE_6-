# Crop Disease Detection & Management System

![Python Version](https://img.shields.io/badge/Python-3.10+-blue.svg) ![Framework](https://img.shields.io/badge/Framework-Flask-green.svg) ![ML Framework](https://img.shields.io/badge/ML-PyTorch-orange.svg)

A full-stack web application that uses a deep learning model to detect diseases in plant leaves and provides AI-powered management advice. This system is designed to be a comprehensive tool for farmers and gardeners to monitor crop health.

---

## Features

- **Multi-Crop Disease Detection:** The system is built on a **ResNet50** model fine-tuned on the comprehensive **PlantVillage dataset**, enabling it to recognize **38 different crop and disease combinations**.
- **Instant AI-Powered Advice:** Utilizes the **Google Gemini API** to provide an immediate, detailed report on the detected disease, including:
  - Description and Symptoms
  - Management and Treatment Strategies
  - Preventative Measures
- **Asynchronous User Interface:** The model's prediction is displayed instantly, while the AI's detailed advice loads in the background for a smooth, non-blocking user experience.
- **Detection History Dashboard:** All predictions are automatically saved to a local **SQLite database**. A dynamic, filterable dashboard allows users to review their entire history of uploaded images and diagnoses.
- **Multiple Input Methods:** Supports both direct **file uploads** and live camera captures from a user's device.
- **Responsive Design:** A clean, modern, and mobile-friendly user interface.

## System Architecture

The application follows a simple yet powerful flow:

1. **Frontend (HTML/CSS/JS):** User uploads or captures a leaf image.
2. **Flask Backend (`/predict` or `/capture`):**
   - The image is received.
   - The **PyTorch ResNet50 model** performs inference to get a prediction.
   - The result (prediction, confidence, image URL) is saved to the **SQLite database**.
   - An immediate JSON response is sent back to the frontend with the prediction.
3. **Frontend (JavaScript):**
   - The prediction is instantly displayed.
   - A second, asynchronous request is made to the `/get_info` endpoint.
4. **Flask Backend (`/get_info`):**
   - The prediction name is sent to the **Google Gemini API**.
   - Gemini's response is received and sent back to the frontend.
5. **Frontend (JavaScript):**
   - The chatbot/advice box is updated with the detailed information from Gemini.

## Technology Stack

- **Backend:** Python, Flask, Flask-SQLAlchemy
- **Machine Learning:** PyTorch, Torchvision
- **AI Chatbot:** Google Gemini API (`gemini-2.0-flash-lite`)
- **Database:** SQLite
- **Frontend:** HTML5, CSS3, JavaScript
- **Deployment:** Development server (can be deployed with Gunicorn/Nginx)

## Dataset

This project utilizes the **PlantVillage Dataset**, a large, open-source collection of plant leaf images. The model was trained on the "color" image set, which contains over 54,000 images across 38 distinct classes.

- **Dataset Name:** PlantVillage Dataset
- **Source:** Kaggle
- **Direct Link:** [https://www.kaggle.com/datasets/abdallahalidev/plantvillage-dataset](https://www.kaggle.com/datasets/abdallahalidev/plantvillage-dataset)

The dataset is not included in this repository due to its large size. Please follow the setup instructions to generate the model by running the provided Google Colab notebook, which automates the download and training process.

## Setup and Installation Guide

Follow these steps to run the project on your local machine.

### 1. Prerequisites
- Git installed on your system.
- Python 3.10 or higher.

### 2. Clone the Repository
```bash
git clone https://github.com/Nischalh777/Capstone_Project_ISE_6-.git
cd Capstone_Project_ISE_6-
```

### 3. Set Up Virtual Environment and Install Dependencies
It is highly recommended to use a virtual environment.

```bash
# Create a virtual environment
python -m venv venv

# Activate the virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

# Install all required packages from the requirements file
pip install -r requirements.txt
```

### 4. Obtain Model Files from Google Colab
The trained model files (`plant_disease_model.pth` and `class_names.json`) are required to run the application. They can be generated by running the provided Google Colab notebook.

**Notebook Link:**  (https://colab.research.google.com/drive/1szPgLCOI904dqIM2xjlnHpZckbsIaCDb?usp=sharing)

**Instructions:**
1. Open the notebook in Google Colab.
2. Follow the instructions in the notebook to upload your `kaggle.json` API key.
3. Run the entire notebook from top to bottom.
4. At the end, the two necessary files will be automatically downloaded to your computer.
5. Move `plant_disease_model.pth` and `class_names.json` into the `models/` directory in your project folder.

### 5. Set Up Environment Variables
Create a file named `.env` in the root of the project directory. This file holds your secret keys and is ignored by Git.

```env
# .env file

# A long, random string for Flask session security
FLASK_SECRET_KEY="replace-this-with-a-long-random-string"

# Your API key from Google AI Studio
GEMINI_API_KEY="your_google_gemini_api_key_here"
```

### 6. Initialize the Database
Before running the app for the first time, you must create the database file and its tables. Run the following command in your terminal once:

```bash
python create_db.py
```

This will generate a `detections.db` file in your project folder.

### 7. Run the Application
You are now ready to start the Flask server.

```bash
python app.py
```

The application will be running and accessible at `http://127.0.0.1:5000` in your web browser.